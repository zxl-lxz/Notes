# 图解 HTTP

## web 和 网络基础

Web 诞生

Web 成长，各种浏览器无视 web 标准

HTTP 较少发展

TCP/IP 协议族

发送：应用层 =》 传输层 =》 网络层 =》 链路层

接收：链路层 =》 网络层 =》 传输层 =》 应用层

IP 协议属于网络层，名字为 Internet Protocal,类似快递，将数据包一站一站的传送

TCP 协议属于传输层，保证数据传输的可靠性。著名的有 TCP 三次握手。

DNS 解析服务也处于应用层，HTTP 协议也处于应用层。

过程：

DNS 查询 =》应用层 HTTP 协议 =》传输层 TCP 协议 =》网络层 IP 协议 =》传输层 TCP 协议 =》应用层 HTTP 协议

URI 组成：

协议 + 登录信息（可选）+ 域名 + 端口 + 文件路径 + 参数 + 标识

例子：`https://user:pass@www.abc.com:80//dir/index.html?uid=1#ch1`

## 概述 HTTP

请求报文组成：

（请求方法 + URI + 协议版本 ） + （请求首部字段） + （内容实体）

响应报文组成：

（协议版本 + 状态码 + 原因短语） + 响应首部字段 + 响应主体

HTTP 本身是无状态协议，不会记录上一次请求的任何信息。这个特点随着发展而不再适用。Cookie 的出现解决了这个问题。

各种请求方法：

GET,POST,HEAD,PUT,TRACE,CONNECT,DELETE,OPTIONS

HTTP/1.1 持久的 TCP 连接，不再一个请求建立一次 TCP 连接。

管线化技术：不必等待上一个请求的响应，再发送下一个请求。请求 1 + 请求 2 =》 响应 1 + 响应 2

set-Cookie 字段，解决客户度端识别问题。解决无状态协议的弊病。

## HTTP 报文

实体主体内容编码

实体主体内容分块编码

实体主体可以包含多种数据类型，这种称为 `多部分对象集合`,也叫 `multipart`,如

```
Content-Type: multipart/form-data; boundary=AaB03x
--AaB03x
Content-Disposition: form-data; name="field1"
　
Joe Blow
--AaB03x
Content-Disposition: form-data; name="pics"; filename="file1.txt"
Content-Type: text/plain
　
...（file1.txt的数据）...
--AaB03x--
```

可以只请求主体的某一个部分的内容。称为范围请求。Range。多个范围请求：multipart/byteranges

## 状态码

```
200: 成功
204: 请求成功，但无资源可以返回，不刷新页面
206: 范围请求成功

301: 永久重定向
302: 临时重定向
303: 请求的资源存在另一个URI，服务器希望客户端能够使用GET方式重新请求这个URI
304: 服务器上没有客户端请求的附带条件的资源。一般用于协商缓存，表示服务器上的资源并没有更新，可以使用本地缓存

400: 请求错误
401: 该请求需要通过HTTP认证
403: 该请求被服务器拒绝。一般用作系统权限管理。
404: 服务器上没有找到请求的资源。

500: 服务器处理请求时，执行出错
503: 服务器宕机或者正忙，无法处理请求。
```

## web 服务器

代理服务器：没经过一个代理服务器，就会追加一个 Via。代理服务器做缓存控制。针对特定 URI 做控制。对报文做修改等。

网关：客户端 =》HTTP 协议 》网关 =》非 HTTP 协议 =》非 HTTP 协议的服务器 =》网关 =》HTTP 协议 =》客户端

隧道：让相隔很远的客户端和服务器能够进行安全通信。SSL。

## HTTP 首部

各种字段，略

## HTTPS

HTTP 的缺点：不验证身份，不加密，不确定报文是否完整

HTTPS,基于 SSL 和 TLS 的通信加密。

HTTPS 通过证书，确认身份

HTTPS 解决确认报文完整性好热正确性问题

HTTP + 身份认证 + 加密 + 完整性保护 = HTTPS

HTTPS 协议，客户端和服务器先进行 SSL 连接，之后再进行 HTTP 连接。

加密方式：

1. 共享加密。加密和解密都使用同一个密钥。也叫做对称加密。它的困境就是加密的同时，必须也将密钥发送给对方。任何人拿到密钥都可以进行破解。

2. 公开密钥加密。也叫做非对称加密。一共有两把密钥。一把叫做私有密钥一把叫做公开密钥。私有密钥只有我自己知道。公开密钥可以让任何人知道。发送秘文的时候，使用公开密钥加密，破解秘文的时候，使用私有密钥解密。

> “要想根据密文和公开密钥，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到。”

> “HTTPS 采用混合加密机制”

> “在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方式”

速度较慢，比较消耗资源。需要购买证书。

## 身份认证

HTTP/1.0 BASIC 认证，不够安全和灵活

HTTP/1.1 DIGEST 认证，还是不够安全

HTTPS SSL 证书认证

用户名和密码登录认证，cookie

## HTTP 协议的改进

SPDY：连接复用，server push,压缩头部信息

WebSocket

HTTP/2.0: 头部压缩，连接复用，二进制协议，客户端拉拽和服务器推送
